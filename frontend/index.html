<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudOps Assistant - Admin Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="config.js"></script>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-cloud"></i>
                    <h1>CloudOps Assistant</h1>
                </div>
                <div class="header-right">
                    <div class="progress-badge">
                        <span>Day <span id="current-day">1</span>/<span id="total-days">30</span></span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 3.3%"></div>
                        </div>
                    </div>
                    <div class="auth-section" id="auth-section">
                        <button class="btn btn-primary" onclick="showLoginModal()">Login</button>
                        <button class="btn btn-secondary" onclick="showRegisterModal()">Register</button>
                    </div>
                    <div class="user-section" id="user-section" style="display: none;">
                        <span id="user-email"></span>
                        <button class="btn btn-secondary" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="drift">
                <i class="fas fa-exclamation-triangle"></i>
                Drift Detection
            </button>
            <button class="tab-btn" data-tab="costs">
                <i class="fas fa-dollar-sign"></i>
                Cost Dashboard
            </button>
            <button class="tab-btn" data-tab="ai">
                <i class="fas fa-robot"></i>
                AI Assistant
            </button>
            <button class="tab-btn" data-tab="monitoring">
                <i class="fas fa-chart-line"></i>
                Monitoring
            </button>
            <button class="tab-btn" data-tab="automation">
                <i class="fas fa-cogs"></i>
                Automation
            </button>
        </nav>

        <!-- Tab Content -->
        <main class="main-content">
            <!-- Drift Detection Tab -->
            <div class="tab-content active" id="drift">
                <div class="feature-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Infrastructure Drift Detection</h2>
                    <p>Monitor your infrastructure for configuration drift and unauthorized changes</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3>GitHub Repository Scanning</h3>
                            <button class="btn btn-info" onclick="showFeatureInfo()" title="About this feature">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <div class="scan-controls">
                            <input type="text" id="github-target" placeholder="GitHub username or org (e.g., rmnicholson0612)" class="github-input">
                            <input type="password" id="github-token" placeholder="GitHub token (optional for public repos)" class="github-input">
                            <button class="btn btn-primary" onclick="scanRepos()">
                                <i class="fas fa-search"></i> Scan Repositories
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="scan-results">Enter a GitHub username or organization to scan for terraform repositories...</div>
                    </div>
                </div>



                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3>Scheduled Drift Monitoring</h3>
                            <button class="btn btn-info" onclick="showDriftInfo()" title="About drift monitoring">
                                <i class="fas fa-info-circle"></i>
                            </button>

                        </div>
                        <button class="btn btn-primary" onclick="showDriftConfigModal()">
                            <i class="fas fa-plus"></i> Add Repository
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="drift-status-display" class="drift-status">
                            <div class="drift-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading drift monitoring status...
                            </div>
                        </div>
                    </div>
                </div>


            </div>

            <!-- Cost Dashboard Tab -->
            <div class="tab-content" id="costs">
                <div class="feature-header">
                    <h2><i class="fas fa-dollar-sign"></i> Cost Management</h2>
                    <p>Track AWS spending and optimize your cloud costs</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3><i class="fas fa-chart-line"></i> Monthly Spending</h3>
                            <button class="btn btn-info" onclick="showCostInfo()" title="About cost tracking">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <div class="month-selector">
                            <select id="month-selector">
                                <!-- Options populated by JavaScript -->
                            </select>
                            <div class="feature-badge">✅ Day 3 Complete</div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="current-cost-display" class="cost-display">
                            <div class="cost-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading current costs...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="cost-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-pie"></i> Service Breakdown</h3>
                        </div>
                        <div class="card-body">
                            <div id="service-costs-display" class="service-costs">
                                <div class="cost-loading">
                                    <i class="fas fa-spinner fa-spin"></i> Loading service costs...
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-calendar-alt"></i> 30-Day Trends</h3>
                        </div>
                        <div class="card-body">
                            <div id="cost-trends-display" class="cost-trends">
                                <div class="cost-loading">
                                    <i class="fas fa-spinner fa-spin"></i> Loading cost trends...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-tags"></i> Cost by Service Tag</h3>
                    </div>
                    <div class="card-body">
                        <div id="tag-costs-display" class="service-costs">
                            <div class="cost-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading tagged costs...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3><i class="fas fa-exclamation-circle"></i> Budget Alerts</h3>
                            <button class="btn btn-info" onclick="showBudgetInfo()" title="About budget alerts">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <button class="btn btn-primary" onclick="showBudgetModal()">
                            <i class="fas fa-bell"></i> Configure Budget Alert
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="budget-status-display" class="budget-status">
                            <div class="budget-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading budget status...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistant Tab -->
            <div class="tab-content" id="ai">
                <div class="feature-header">
                    <h2><i class="fas fa-robot"></i> AI-Powered DevOps</h2>
                    <p>Leverage AI for infrastructure insights, documentation, and automation</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3><i class="fas fa-search-plus"></i> Smart Resource Discovery</h3>
                            <button class="btn btn-info" onclick="showResourceDiscoveryInfo()" title="About Resource Discovery">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <div class="feature-badge">✅ Day 11 Complete</div>
                        </div>
                        <button class="btn btn-primary" onclick="openResourceDiscovery()">
                            <i class="fas fa-external-link-alt"></i> Open Resource Discovery
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="resource-discovery-display" class="resource-discovery">
                            <div class="capabilities">
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Automatically discover all AWS resources across your account</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>AI-powered service grouping based on tags and naming patterns</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Cost attribution: see exactly what each service costs monthly</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Manual and scheduled scanning with drift detection</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Interactive approval workflow for AI service suggestions</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Extremely cost-effective: ~$0.25/month for full account scanning</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3><i class="fas fa-file-code"></i> AI Terraform Explainer</h3>
                            <button class="btn btn-info" onclick="showAIInfo()" title="About AI Terraform Explainer">
                                <i class="fas fa-info-circle"></i>
                            </button>

                        </div>
                        <button class="btn btn-primary" onclick="loadAIExplanations()">
                            <i class="fas fa-refresh"></i> Refresh Explanations
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="ai-explanations-display" class="ai-explanations">
                            <div class="ai-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading AI explanations...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3><i class="fas fa-clipboard-list"></i> Automated Postmortem Generator</h3>
                            <button class="btn btn-info" onclick="showPostmortemInfo()" title="About Postmortem Generator">
                                <i class="fas fa-info-circle"></i>
                            </button>

                        </div>
                        <button class="btn btn-primary" onclick="showCreatePostmortemModal()">
                            <i class="fas fa-plus"></i> Create Postmortem
                        </button>
                        <button class="btn btn-secondary" onclick="loadPostmortems()">
                            <i class="fas fa-refresh"></i> Refresh Postmortems
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="postmortems-display" class="postmortems">
                            <div class="postmortem-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading postmortems...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3><i class="fas fa-search"></i> Service Documentation Search</h3>
                            <button class="btn btn-info" onclick="showServiceDocsInfoModal()" title="About Service Documentation">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <button class="btn btn-primary" onclick="openServiceDocs()">
                            <i class="fas fa-external-link-alt"></i> Open Documentation Search
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="service-docs-display" class="service-docs">
                            <div class="capabilities">
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Register services and upload multiple documents per service</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Natural language search: "How do I restart the payment service?"</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>AI-powered conversational responses with source citations</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Document management: view, edit, and delete documentation</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Shared documentation accessible by all team members</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Perfect for incident response and daily operations</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="header-with-info">
                            <h3><i class="fab fa-slack"></i> Slack Bot Integration</h3>
                            <button class="btn btn-info" onclick="showSlackInfo()" title="About Slack Bot">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <div class="feature-badge">✅ Day 12 Complete</div>
                        </div>
                        <button class="btn btn-primary" onclick="showSlackSetupModal()">
                            <i class="fas fa-cog"></i> Configure Slack Bot
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="slack-status-display" class="slack-status">
                            <div class="slack-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading Slack bot status...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monitoring Tab -->
            <div class="tab-content" id="monitoring">
                <div class="feature-header">
                    <h2><i class="fas fa-chart-line"></i> Observability & Monitoring</h2>
                    <p>Comprehensive monitoring for uptime, performance, and system health</p>
                </div>

                <div class="coming-soon-banner">
                    <i class="fas fa-eye"></i>
                    <h3>Coming Week 3</h3>
                    <p>Full observability stack with uptime monitoring, latency tracking, and status pages</p>
                </div>

                <div class="feature-grid">
                    <div class="feature-card coming-soon">
                        <i class="fas fa-heartbeat"></i>
                        <h4>Uptime Monitoring</h4>
                        <p>Day 15 - Service availability</p>
                    </div>
                    <div class="feature-card coming-soon">
                        <i class="fas fa-tachometer-alt"></i>
                        <h4>Latency Tracking</h4>
                        <p>Day 16 - Performance metrics</p>
                    </div>
                    <div class="feature-card coming-soon">
                        <i class="fas fa-flag"></i>
                        <h4>Feature Flags</h4>
                        <p>Day 17 - Safe deployments</p>
                    </div>
                    <div class="feature-card coming-soon">
                        <i class="fas fa-globe"></i>
                        <h4>Status Page</h4>
                        <p>Day 21 - Public status</p>
                    </div>
                </div>
            </div>

            <!-- Automation Tab -->
            <div class="tab-content" id="automation">
                <div class="feature-header">
                    <h2><i class="fas fa-cogs"></i> DevOps Automation</h2>
                    <p>Automate deployments, backups, and incident response workflows</p>
                </div>

                <div class="coming-soon-banner">
                    <i class="fas fa-magic"></i>
                    <h3>Coming Week 4</h3>
                    <p>Advanced automation features for deployment, backup, and incident management</p>
                </div>

                <div class="feature-grid">
                    <div class="feature-card coming-soon">
                        <i class="fas fa-undo"></i>
                        <h4>One-Click Rollbacks</h4>
                        <p>Day 19 - ECS rollback automation</p>
                    </div>
                    <div class="feature-card coming-soon">
                        <i class="fas fa-tasks"></i>
                        <h4>Job Queue</h4>
                        <p>Day 22 - Background processing</p>
                    </div>
                    <div class="feature-card coming-soon">
                        <i class="fas fa-shield-alt"></i>
                        <h4>VPN Wizard</h4>
                        <p>Day 24 - Secure access setup</p>
                    </div>
                    <div class="feature-card coming-soon">
                        <i class="fas fa-users"></i>
                        <h4>Multi-Tenant</h4>
                        <p>Day 27 - Team management</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Plan Upload Modal -->
    <div id="upload-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-upload"></i> Upload Terraform Plan</h2>
                <span class="close" onclick="closeUploadModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="upload-info">
                    <h4>Repository: <span id="upload-repo-name"></span></h4>
                    <p>Upload your terraform plan output to detect real infrastructure drift.</p>
                </div>

                <div class="upload-instructions">
                    <h4><i class="fas fa-terminal"></i> How to generate plan:</h4>
                    <div class="code-block">
                        <code>cd your-terraform-repo<br>
terraform plan > plan.txt</code>
                    </div>
                </div>

                <div class="upload-area">
                    <input type="file" id="plan-file" accept=".txt,.log,.out" style="display: none;">
                    <div class="file-drop-zone" onclick="document.getElementById('plan-file').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to select terraform plan file</p>
                        <small>Supports .txt, .log, .out files</small>
                    </div>
                </div>

                <div class="upload-actions">
                    <button class="btn btn-primary" onclick="uploadPlan()" id="upload-btn" disabled>
                        <i class="fas fa-upload"></i> Upload & Analyze
                    </button>
                    <button class="btn btn-secondary" onclick="closeUploadModal()">
                        Cancel
                    </button>
                </div>

                <div id="upload-result" class="upload-result"></div>
            </div>
        </div>
    </div>

    <!-- Feature Info Modal -->
    <div id="feature-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> About Terraform Detection</h2>
                <span class="close" onclick="closeFeatureInfo()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="info-section">
                    <h3><i class="fas fa-search"></i> How It Works</h3>
                    <p>The system uses the <strong>GitHub Contents API</strong> to inspect each repository's files and detect Terraform infrastructure code.</p>

                    <div class="process-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>Discover Repositories</strong>
                                <p>Fetches all repositories for the specified user or organization</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>Check File Contents</strong>
                                <p>For each repo, calls GitHub API to list root directory files</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>Pattern Matching</strong>
                                <p>Looks for Terraform indicators in file names and directories</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <strong>Drift Detection</strong>
                                <p>Detects infrastructure changes and configuration drift</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-bullseye"></i> Detection Patterns</h3>
                    <div class="detection-patterns">
                        <div class="pattern-group">
                            <h4>Terraform Files</h4>
                            <ul>
                                <li><code>*.tf</code> - Terraform configuration files</li>
                                <li><code>main.tf</code> - Main configuration</li>
                                <li><code>variables.tf</code> - Variable definitions</li>
                                <li><code>outputs.tf</code> - Output definitions</li>
                            </ul>
                        </div>
                        <div class="pattern-group">
                            <h4>Directory Names</h4>
                            <ul>
                                <li><code>terraform/</code> - Common terraform directory</li>
                                <li><code>infrastructure/</code> - Alternative IaC directory</li>
                                <li><code>infra/</code> - Short form infrastructure</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-chart-line"></i> Current Capabilities</h3>
                    <div class="capabilities">
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Scans user and organization repositories</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Works with public repositories (no token required)</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Supports private repos with GitHub token</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Real drift detection from terraform plans</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Stores scan history in DynamoDB</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-rocket"></i> Future Enhancements</h3>
                    <div class="future-features">
                        <div class="future-item">
                            <div class="future-day">✅ Complete</div>
                            <div class="future-desc">Scheduled automatic scanning</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">Day 12</div>
                            <div class="future-desc">Slack notifications for drift</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">Day 18</div>
                            <div class="future-desc">Smart alert routing to repo owners</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">✅ Complete</div>
                            <div class="future-desc">Real terraform plan execution</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">Future</div>
                            <div class="future-desc">Recursive directory scanning</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">Future</div>
                            <div class="future-desc">Integration with CI/CD pipelines</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-lightbulb"></i> Why This Approach Works</h3>
                    <div class="benefits">
                        <div class="benefit">
                            <i class="fas fa-tachometer-alt"></i>
                            <div>
                                <strong>Fast</strong>
                                <p>Single API call per repository for detection</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-bullseye"></i>
                            <div>
                                <strong>Accurate</strong>
                                <p>Catches 90%+ of terraform repositories</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-dollar-sign"></i>
                            <div>
                                <strong>Cost-Effective</strong>
                                <p>Uses free GitHub API with generous rate limits</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <strong>Reliable</strong>
                                <p>Built on official GitHub API with error handling</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cost Info Modal -->
    <div id="cost-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-dollar-sign"></i> About Cost Management</h2>
                <span class="close" onclick="closeCostInfo()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="info-section">
                    <h3><i class="fas fa-chart-line"></i> How It Works</h3>
                    <p>The cost dashboard integrates with <strong>AWS Cost Explorer API</strong> to provide real-time visibility into your AWS spending across multiple dimensions.</p>

                    <div class="process-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>Cost Explorer Integration</strong>
                                <p>Connects to AWS Cost Explorer API to fetch billing data</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>Smart Caching</strong>
                                <p>Caches cost data for 1 hour to minimize API calls and costs</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>Multi-Dimensional Analysis</strong>
                                <p>Groups costs by AWS service, time period, and custom tags</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <strong>Historical Comparison</strong>
                                <p>Compare spending across different months and time periods</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-chart-pie"></i> Cost Dimensions</h3>
                    <div class="detection-patterns">
                        <div class="pattern-group">
                            <h4>Monthly Spending</h4>
                            <ul>
                                <li><code>Total Cost</code> - Complete monthly AWS bill</li>
                                <li><code>Historical</code> - Last 12 months available</li>
                                <li><code>Real-time</code> - Current month updates daily</li>
                            </ul>
                        </div>
                        <div class="pattern-group">
                            <h4>Service Breakdown</h4>
                            <ul>
                                <li><code>AWS Services</code> - Lambda, DynamoDB, S3, etc.</li>
                                <li><code>Top 10</code> - Highest cost services first</li>
                                <li><code>Threshold</code> - Only shows costs > $0.01</li>
                            </ul>
                        </div>
                        <div class="pattern-group">
                            <h4>Service Tags</h4>
                            <ul>
                                <li><code>"Service" Tag</code> - Groups by custom service tags</li>
                                <li><code>Untagged</code> - Resources without Service tag</li>
                                <li><code>Cost Allocation</code> - Track spending by business unit</li>
                            </ul>
                        </div>
                        <div class="pattern-group">
                            <h4>Daily Trends</h4>
                            <ul>
                                <li><code>30-Day History</code> - Daily spending patterns</li>
                                <li><code>Trend Analysis</code> - Identify spending spikes</li>
                                <li><code>Last 7 Days</code> - Recent activity focus</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-cogs"></i> Current Capabilities</h3>
                    <div class="capabilities">
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Real-time AWS cost tracking with Cost Explorer</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Monthly cost comparison (last 12 months)</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Service-level cost breakdown and analysis</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Cost tracking by custom "Service" tags</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>30-day daily spending trends and patterns</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Smart caching to minimize API costs</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Responsive design for mobile and desktop</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-rocket"></i> Future Enhancements</h3>
                    <div class="future-features">
                        <div class="future-item">
                            <div class="future-day">✅ Complete</div>
                            <div class="future-desc">Budget alerts and thresholds</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">✅ Complete</div>
                            <div class="future-desc">AI-powered cost optimization tips</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">Day 12</div>
                            <div class="future-desc">Slack notifications for cost spikes</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">Future</div>
                            <div class="future-desc">Interactive cost charts and graphs</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">Future</div>
                            <div class="future-desc">Cost forecasting and predictions</div>
                        </div>
                        <div class="future-item">
                            <div class="future-day">Future</div>
                            <div class="future-desc">Multi-account cost consolidation</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-lightbulb"></i> Cost Optimization Tips</h3>
                    <div class="benefits">
                        <div class="benefit">
                            <i class="fas fa-tags"></i>
                            <div>
                                <strong>Tag Everything</strong>
                                <p>Add "Service" tags to all resources for better cost allocation</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-chart-line"></i>
                            <div>
                                <strong>Monitor Trends</strong>
                                <p>Watch for unexpected cost spikes in daily trends</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-clock"></i>
                            <div>
                                <strong>Regular Reviews</strong>
                                <p>Check costs monthly to identify optimization opportunities</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <strong>Set Budgets</strong>
                                <p>Use AWS Budgets alongside this dashboard for alerts</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-exclamation-triangle"></i> Prerequisites</h3>
                    <div class="capabilities">
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>AWS Cost Explorer must be enabled (free)</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>24-hour delay for Cost Explorer data availability</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>IAM permissions for Cost Explorer API access</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>"Service" tags on resources for tag-based costs</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-dollar-sign"></i> Cost-Effective Design</h3>
                    <div class="benefits">
                        <div class="benefit">
                            <i class="fas fa-memory"></i>
                            <div>
                                <strong>Smart Caching</strong>
                                <p>1-hour cache reduces Cost Explorer API calls by 95%</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-server"></i>
                            <div>
                                <strong>Serverless</strong>
                                <p>Lambda functions only run when you view costs</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-database"></i>
                            <div>
                                <strong>DynamoDB TTL</strong>
                                <p>Automatic cache cleanup prevents storage costs</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-tachometer-alt"></i>
                            <div>
                                <strong>Optimized Queries</strong>
                                <p>Efficient API calls minimize Cost Explorer charges</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Budget Info Modal -->
    <div id="budget-info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-exclamation-circle"></i> About Budget Alerts</h2>
                <span class="close" onclick="closeBudgetInfo()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="info-section">
                    <h3><i class="fas fa-bell"></i> How Budget Alerts Work</h3>
                    <p>Budget alerts monitor your AWS spending and send notifications when you exceed configured thresholds.</p>

                    <div class="process-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>Set Monthly Limit</strong>
                                <p>Configure your monthly AWS spending budget</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>Choose Thresholds</strong>
                                <p>Select at 50%, 80%, and/or 100% of your budget</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>Automatic Monitoring</strong>
                                <p>System checks spending daily and sends alerts via SNS</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-cogs"></i> Current Capabilities</h3>
                    <div class="capabilities">
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Real-time spending tracking with Cost Explorer</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Multiple budget configurations per account</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Customizable alert thresholds (50%, 80%, 100%)</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Service-specific budget filtering</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>SNS email notifications for budget alerts</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Budget status dashboard with projections</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-lightbulb"></i> Best Practices</h3>
                    <div class="benefits">
                        <div class="benefit">
                            <i class="fas fa-percentage"></i>
                            <div>
                                <strong>Set Conservative Limits</strong>
                                <p>Start with lower budgets and adjust based on actual usage</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <strong>Email Alerts</strong>
                                <p>Automatic SNS topic creation and email subscription</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-filter"></i>
                            <div>
                                <strong>Use Service Filters</strong>
                                <p>Create separate budgets for different AWS services</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Info Modal -->
    <div id="ai-info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-robot"></i> About AI Terraform Explainer</h2>
                <span class="close" onclick="closeAIInfo()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="info-section">
                    <h3><i class="fas fa-magic"></i> How It Works</h3>
                    <p>The AI Terraform Explainer uses <strong>AWS Bedrock</strong> to analyze your terraform plans and provide human-readable explanations of infrastructure changes.</p>

                    <div class="process-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>Upload Terraform Plan</strong>
                                <p>Upload your terraform plan output from any repository</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>AI Analysis</strong>
                                <p>AWS Bedrock analyzes the plan and identifies changes, risks, and impacts</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>Plain English Explanation</strong>
                                <p>Get clear explanations of what will change and why it matters</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-brain"></i> AI Capabilities</h3>
                    <div class="capabilities">
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Explains complex terraform changes in simple terms</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Identifies potential risks and security implications</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Provides actionable recommendations</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Analyzes resource dependencies and impacts</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Fallback analysis when AI is unavailable</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-shield-alt"></i> Risk Assessment</h3>
                    <div class="detection-patterns">
                        <div class="pattern-group">
                            <h4 style="color: #28a745;">LOW Risk</h4>
                            <ul>
                                <li>Tag changes and metadata updates</li>
                                <li>Non-critical configuration changes</li>
                                <li>Adding new resources without dependencies</li>
                            </ul>
                        </div>
                        <div class="pattern-group">
                            <h4 style="color: #ffc107;">MEDIUM Risk</h4>
                            <ul>
                                <li>Configuration changes affecting functionality</li>
                                <li>Security group or IAM policy modifications</li>
                                <li>Resource scaling or type changes</li>
                            </ul>
                        </div>
                        <div class="pattern-group">
                            <h4 style="color: #dc3545;">HIGH Risk</h4>
                            <ul>
                                <li>Resource destruction or replacement</li>
                                <li>Database or storage changes</li>
                                <li>Network or security critical modifications</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-lightbulb"></i> Smart Recommendations</h3>
                    <div class="benefits">
                        <div class="benefit">
                            <i class="fas fa-backup"></i>
                            <div>
                                <strong>Backup Warnings</strong>
                                <p>Alerts when changes might require data backups</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-test-tube"></i>
                            <div>
                                <strong>Testing Advice</strong>
                                <p>Suggests testing strategies for different change types</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-clock"></i>
                            <div>
                                <strong>Timing Guidance</strong>
                                <p>Recommends best times to apply changes</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-cogs"></i> Technical Details</h3>
                    <div class="capabilities">
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Powered by AWS Bedrock with Claude models</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Intelligent fallback analysis when AI is unavailable</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Handles ANSI color codes and complex plan formats</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Stores explanations for future reference</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-sign-in-alt"></i> Login</h2>
                <span class="close" onclick="closeLoginModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="auth-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="your-email@example.com">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="Your password">
                    </div>
                </div>
                <div class="auth-actions">
                    <button class="btn btn-primary" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <button class="btn btn-secondary" onclick="closeLoginModal()">
                        Cancel
                    </button>
                </div>
                <div id="login-result" class="auth-result"></div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Register</h2>
                <span class="close" onclick="closeRegisterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="auth-form">
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" placeholder="your-email@example.com">
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" placeholder="Minimum 8 characters">
                    </div>
                </div>
                <div class="auth-actions">
                    <button class="btn btn-primary" onclick="register()">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                    <button class="btn btn-secondary" onclick="closeRegisterModal()">
                        Cancel
                    </button>
                </div>
                <div id="register-result" class="auth-result"></div>
            </div>
        </div>
    </div>

    <!-- Drift Configuration Modal -->
    <div id="drift-config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calendar-day"></i> Configure Drift Monitoring</h2>
                <span class="close" onclick="closeDriftConfigModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="drift-config-form">
                    <div class="form-group">
                        <label for="drift-repo-name">Repository Name</label>
                        <input type="text" id="drift-repo-name" placeholder="Enter GitHub URL first" readonly>
                    </div>

                    <div class="form-group">
                        <label for="drift-github-url">GitHub URL</label>
                        <input type="url" id="drift-github-url" placeholder="https://github.com/user/repo.git" oninput="autoFillRepoName()">
                    </div>

                    <div class="form-group">
                        <label for="drift-terraform-dir">Terraform Directory</label>
                        <input type="text" id="drift-terraform-dir" placeholder="." value=".">
                        <small>Path to terraform files within the repository</small>
                    </div>

                    <div class="form-group">
                        <label for="drift-schedule">Scan Schedule</label>
                        <select id="drift-schedule">
                            <option value="daily">Daily</option>
                            <option value="hourly">Hourly</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="drift-alert-email">Alert Email (Optional)</label>
                        <input type="email" id="drift-alert-email" placeholder="your-email@example.com">
                        <small>Receive email notifications when drift is detected</small>
                    </div>
                </div>

                <div class="drift-config-actions">
                    <button class="btn btn-primary" onclick="saveDriftConfig()">
                        <i class="fas fa-save"></i> Save Configuration
                    </button>
                    <button class="btn btn-secondary" onclick="closeDriftConfigModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Postmortem Info Modal -->
    <div id="postmortem-info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-clipboard-list"></i> About Automated Postmortem Generator</h2>
                <span class="close" onclick="closePostmortemInfo()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="info-section">
                    <h3><i class="fas fa-magic"></i> How It Works</h3>
                    <p>The Automated Postmortem Generator creates comprehensive incident reports using <strong>AI-powered analysis</strong> combined with real infrastructure data.</p>

                    <div class="process-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>Create Incident</strong>
                                <p>Define incident details: title, service, severity, time range, and summary</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>Data Collection</strong>
                                <p>Optionally include terraform plans and cost data from the incident timeframe</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>AI Analysis</strong>
                                <p>AWS Bedrock generates comprehensive 2-page executive-quality reports</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-brain"></i> AI-Generated Sections</h3>
                    <div class="capabilities">
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Executive Summary for stakeholders</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Detailed root cause analysis</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Comprehensive impact assessment</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Detection and response timeline</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Resolution details and procedures</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Lessons learned and strategic insights</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Prioritized action items</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Preventive measures recommendations</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Monitoring and alerting improvements</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-users"></i> Team Features</h3>
                    <div class="detection-patterns">
                        <div class="pattern-group">
                            <h4>Owner Assignment</h4>
                            <ul>
                                <li>Assign postmortems to team members</li>
                                <li>Track ownership and accountability</li>
                                <li>Integrate with Cognito user management</li>
                            </ul>
                        </div>
                        <div class="pattern-group">
                            <h4>Status Tracking</h4>
                            <ul>
                                <li>Draft, In Progress, Complete statuses</li>
                                <li>Track postmortem lifecycle</li>
                                <li>Update and collaborate on reports</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-database"></i> Data Integration</h3>
                    <div class="benefits">
                        <div class="benefit">
                            <i class="fas fa-code"></i>
                            <div>
                                <strong>Terraform Plans</strong>
                                <p>Include infrastructure changes from incident timeframe</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-dollar-sign"></i>
                            <div>
                                <strong>Cost Impact</strong>
                                <p>Analyze financial impact during incident period</p>
                            </div>
                        </div>
                        <div class="benefit">
                            <i class="fas fa-clock"></i>
                            <div>
                                <strong>Time-based Analysis</strong>
                                <p>Correlate events within specified time ranges</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-shield-alt"></i> Professional Quality</h3>
                    <div class="capabilities">
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Executive-level reporting suitable for stakeholders</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Technical depth for engineering teams</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Actionable recommendations and next steps</span>
                        </div>
                        <div class="capability">
                            <i class="fas fa-check-circle"></i>
                            <span>Structured format for consistency</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Slack Setup Modal -->
    <div id="slack-setup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fab fa-slack"></i> Slack Bot Setup</h2>
                <span class="close" onclick="closeSlackSetupModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="slack-setup-steps">
                    <div class="setup-step">
                        <h4><i class="fas fa-1"></i> API Endpoints</h4>
                        <p>Use these URLs in your Slack app configuration:</p>
                        <div class="endpoint-box">
                            <label>Events URL:</label>
                            <input type="text" id="slack-events-url" readonly>
                            <button class="btn btn-sm btn-secondary" onclick="copyToClipboard('slack-events-url')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="endpoint-box">
                            <label>Commands URL:</label>
                            <input type="text" id="slack-commands-url" readonly>
                            <button class="btn btn-sm btn-secondary" onclick="copyToClipboard('slack-commands-url')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>

                    <div class="setup-step">
                        <h4><i class="fas fa-2"></i> Available Commands</h4>
                        <div class="commands-list">
                            <div class="command-item">
                                <code>/cloudops status</code>
                                <span>Infrastructure overview</span>
                            </div>
                            <div class="command-item">
                                <code>/cloudops drift [repo]</code>
                                <span>Check drift status</span>
                            </div>
                            <div class="command-item">
                                <code>/cloudops costs [service]</code>
                                <span>Cost analysis</span>
                            </div>
                            <div class="command-item">
                                <code>/cloudops incident [title]</code>
                                <span>Start incident</span>
                            </div>
                            <div class="command-item">
                                <code>@CloudOps [question]</code>
                                <span>AI-powered Q&A</span>
                            </div>
                        </div>
                    </div>

                    <div class="setup-step">
                        <h4><i class="fas fa-3"></i> Setup Instructions</h4>
                        <ol>
                            <li>Create a Slack app at <a href="https://api.slack.com/apps" target="_blank">api.slack.com/apps</a></li>
                            <li>Add bot permissions: <code>app_mentions:read</code>, <code>chat:write</code>, <code>commands</code></li>
                            <li>Create slash command <code>/cloudops</code> with the Commands URL above</li>
                            <li>Enable Events API with the Events URL above</li>
                            <li>Subscribe to <code>app_mention</code> events</li>
                            <li>Install the app to your workspace</li>
                        </ol>
                        <a href="SLACK_SETUP.md" target="_blank" class="btn btn-primary">
                            <i class="fas fa-book"></i> Full Setup Guide
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Budget Configuration Modal -->
    <div id="budget-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-bell"></i> Configure Budget Alert</h2>
                <span class="close" onclick="closeBudgetModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="budget-form">
                    <div class="form-group">
                        <label for="budget-name">Budget Name</label>
                        <input type="text" id="budget-name" placeholder="e.g., Monthly AWS Budget" value="Monthly AWS Budget">
                    </div>

                    <div class="form-group">
                        <label for="budget-amount">Monthly Limit ($)</label>
                        <input type="number" id="budget-amount" placeholder="100.00" min="1" step="0.01">
                    </div>

                    <div class="form-group">
                        <label for="budget-email">Email for Alerts (Optional)</label>
                        <input type="email" id="budget-email" placeholder="your-email@example.com">
                    </div>

                    <div class="form-group">
                        <label>Alert Thresholds</label>
                        <div class="threshold-options">
                            <label><input type="checkbox" checked> 50% of budget</label>
                            <label><input type="checkbox" checked> 80% of budget</label>
                            <label><input type="checkbox" checked> 100% of budget</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="service-filter">Service Filter</label>
                        <select id="service-filter">
                            <option value="all">All AWS Services</option>
                            <option value="Amazon Elastic Compute Cloud - Compute">EC2</option>
                            <option value="AWS Lambda">Lambda</option>
                            <option value="Amazon Simple Storage Service">S3</option>
                            <option value="Amazon DynamoDB">DynamoDB</option>
                        </select>
                    </div>
                </div>

                <div class="budget-actions">
                    <button class="btn btn-primary" onclick="saveBudgetConfig()">
                        <i class="fas fa-save"></i> Save Budget Alert
                    </button>
                    <button class="btn btn-secondary" onclick="closeBudgetModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.dataset.tab;

                // Remove active class from all tabs and content
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab and corresponding content
                btn.classList.add('active');
                document.getElementById(tabId).classList.add('active');

                // Load cost data when costs tab is activated
                if (tabId === 'costs') {
                    loadCostData();
                }

                // Load drift status when drift tab is activated
                if (tabId === 'drift') {
                    loadDriftStatus();
                }

                // Load AI explanations when AI tab is activated
                if (tabId === 'ai') {
                    loadAIExplanations();
                    loadPostmortems();
                    loadSlackStatus();
                }
            });
        });

        // Initialize app with config values
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-day').textContent = CONFIG.CURRENT_DAY;
            document.getElementById('total-days').textContent = CONFIG.TOTAL_DAYS;
            const progressPercent = (CONFIG.CURRENT_DAY / CONFIG.TOTAL_DAYS * 100).toFixed(1);
            document.getElementById('progress-fill').style.width = progressPercent + '%';

            // Update page title with current day
            document.title = `CloudOps Assistant - Day ${CONFIG.CURRENT_DAY}/${CONFIG.TOTAL_DAYS}`;

            // Check authentication status
            checkAuthStatus();

            // Initialize month selector immediately
            initializeMonthSelector();

            // Load cost data if costs tab is initially active
            if (document.querySelector('.tab-btn[data-tab="costs"]').classList.contains('active')) {
                loadCostData();
            }

            // Load drift status only if logged in
            if (localStorage.getItem('access_token')) {
                // Auto-setup drift monitoring from config
                setTimeout(autoSetupDriftMonitoring, 2000);
            } else {
                // Show login message immediately if not logged in
                loadDriftStatus();
            }
        });

        // Repository scanning functionality
        async function scanRepos() {
            const githubTarget = document.getElementById('github-target').value.trim();
            const githubToken = document.getElementById('github-token').value.trim();
            const resultsElement = document.getElementById('scan-results');

            if (!githubTarget) {
                resultsElement.innerHTML = '<div class="error"><i class="fas fa-exclamation-circle"></i> Please enter a GitHub username or organization</div>';
                return;
            }

            const token = localStorage.getItem('access_token');
            if (!token) {
                resultsElement.innerHTML = '<div class="error"><i class="fas fa-lock"></i> Please login to scan repositories</div>';
                return;
            }

            resultsElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scanning repositories...';

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/scan-repos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        github_target: githubTarget,
                        github_token: githubToken || null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    displayScanResults(data);
                } else {
                    resultsElement.innerHTML = `<div class="error">
                        <i class="fas fa-times-circle"></i> <strong>Error scanning repositories</strong>
                        <p>${data.error || 'Unknown error occurred'}</p>
                    </div>`;
                }
            } catch (error) {
                resultsElement.innerHTML = `<div class="error">
                    <i class="fas fa-times-circle"></i> <strong>Network error</strong>
                    <p>Failed to connect to the API. Please check your configuration.</p>
                </div>`;
            }
        }

        function displayScanResults(data) {
            const resultsElement = document.getElementById('scan-results');

            if (data.terraform_repos === 0) {
                resultsElement.innerHTML = `<div class="no-drift">
                    <i class="fas fa-info-circle"></i> <strong>No Terraform repositories found</strong>
                    <p>Scanned ${data.total_repos} repositories for ${data.target}, but none contain Terraform files.</p>
                </div>`;
                return;
            }

            let html = `<div class="scan-summary">
                <h4><i class="fas fa-github"></i> Scan Results for ${data.target}</h4>
                <p>Found ${data.terraform_repos} Terraform repositories out of ${data.total_repos} total repositories</p>
            </div>`;

            html += '<div class="repo-results">';

            data.results.forEach(repo => {
                const statusIcon = repo.drift_detected ?
                    '<i class="fas fa-exclamation-triangle" style="color: #ffc107;"></i>' :
                    '<i class="fas fa-check-circle" style="color: #28a745;"></i>';

                const statusText = repo.drift_detected ?
                    `${repo.changes.length} changes detected` :
                    'No drift detected';

                html += `<div class="repo-item ${repo.drift_detected ? 'has-drift' : 'no-drift'}">
                    <div class="repo-header">
                        ${statusIcon}
                        <strong><a href="${repo.repo_url}" target="_blank">${repo.repo_name}</a></strong>
                        <span class="status">${statusText}</span>
                    </div>

                    <div class="repo-actions">
                        <button class="btn btn-primary btn-sm" onclick="showUploadModal('${repo.repo_name}', '${data.target}')">
                            <i class="fas fa-upload"></i> Upload Plan
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="viewRepoHistory('${repo.repo_name}', '${data.target}')">
                            <i class="fas fa-history"></i> History
                        </button>
                        <button class="btn btn-success btn-sm" onclick="addToMonitoring('${repo.repo_name}', '${repo.repo_url}', '${data.target}')">
                            <i class="fas fa-plus"></i> Monitor
                        </button>
                    </div>`;

                if (repo.drift_detected && repo.changes.length > 0) {
                    html += '<div class="drift-details">';
                    repo.changes.forEach(change => {
                        html += `<div class="drift-item">${change}</div>`;
                    });
                    html += '</div>';
                }

                html += '</div>';
            });

            html += '</div>';
            resultsElement.innerHTML = html;
        }

        // Plan upload functionality
        let currentRepo = null;
        let currentTarget = null;

        function showUploadModal(repoName, githubTarget) {
            currentRepo = repoName;
            currentTarget = githubTarget;
            document.getElementById('upload-repo-name').textContent = repoName;
            document.getElementById('upload-modal').style.display = 'block';
            document.getElementById('upload-result').innerHTML = '';
        }

        function closeUploadModal() {
            document.getElementById('upload-modal').style.display = 'none';
            document.getElementById('plan-file').value = '';
            document.getElementById('upload-btn').disabled = true;
        }

        async function viewRepoHistory(repoName, githubTarget) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to view plan history');
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/plan-history/${repoName}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    showHistoryModal(data);
                } else {
                    alert(`Error loading history: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to load plan history');
            }
        }

        function showHistoryModal(historyData) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            let historyHtml = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-history"></i> Plan History - ${historyData.repo_name}</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <p>Found ${historyData.total} plan(s) for this repository</p>
                        <div class="history-timeline">`;

            historyData.plans.forEach((plan, index) => {
                const date = new Date(plan.timestamp).toLocaleString();
                historyHtml += `
                    <div class="history-item">
                        <div class="history-date">${date}</div>
                        <div class="history-changes">${plan.changes_detected} changes detected</div>
                        <div class="history-actions">
                            <button class="btn btn-sm btn-secondary" onclick="viewPlanDetails('${plan.plan_id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${index < historyData.plans.length - 1 ?
                                `<button class="btn btn-sm btn-primary" onclick="comparePlans('${plan.plan_id}', '${historyData.plans[index + 1].plan_id}')">
                                    <i class="fas fa-code-branch"></i> Compare
                                </button>` : ''}
                        </div>
                    </div>`;
            });

            historyHtml += `
                        </div>
                    </div>
                </div>`;

            modal.innerHTML = historyHtml;
            document.body.appendChild(modal);
        }

        async function comparePlans(planId1, planId2) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to compare plans');
                return;
            }

            try {
                const encodedPlan1 = encodeURIComponent(planId1);
                const encodedPlan2 = encodeURIComponent(planId2);
                const response = await fetch(`${CONFIG.API_BASE_URL}/compare-plans/${encodedPlan1}/${encodedPlan2}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    showComparisonModal(data);
                } else {
                    alert(`Error comparing plans: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to compare plans');
            }
        }

        function showComparisonModal(comparisonData) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            let diffHtml = comparisonData.diff.map(line => {
                if (line.startsWith('+')) return `<div class="diff-added">${line}</div>`;
                if (line.startsWith('-')) return `<div class="diff-removed">${line}</div>`;
                return `<div class="diff-context">${line}</div>`;
            }).join('');

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-code-branch"></i> Plan Comparison</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="comparison-header">
                            <div class="plan-info">
                                <strong>Plan 1:</strong> ${new Date(comparisonData.plan1.timestamp).toLocaleString()}
                                <span>(${comparisonData.plan1.changes} changes)</span>
                            </div>
                            <div class="plan-info">
                                <strong>Plan 2:</strong> ${new Date(comparisonData.plan2.timestamp).toLocaleString()}
                                <span>(${comparisonData.plan2.changes} changes)</span>
                            </div>
                        </div>
                        <div class="diff-viewer">${diffHtml}</div>
                    </div>
                </div>`;

            document.body.appendChild(modal);
        }

        async function viewPlanDetails(planId) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to view plan details');
                return;
            }

            try {
                const encodedPlanId = encodeURIComponent(planId);
                const response = await fetch(`${CONFIG.API_BASE_URL}/plan-details/${encodedPlanId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    showPlanDetailsModal(data);
                } else {
                    alert(`Error loading plan details: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to load plan details');
            }
        }

        function showPlanDetailsModal(planData) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            const date = new Date(planData.timestamp).toLocaleString();
            let content = planData.plan_content || 'No plan content available';
            let isError = content.includes('Failed to') || content.includes('Error:') || content.includes('fatal:') || content.includes('no space left');

            if (!isError) {
                // Clean up and format terraform plan content
                content = content
                    .replace(/\x1b\[[0-9;]*m/g, '') // Remove ANSI color codes
                    .replace(/\x00/g, '') // Remove null characters
                    .replace(/Reading\.\.\./g, 'Reading...\n')
                    .replace(/Readcomplete/g, 'Read complete')
                    .replace(/after0s/g, 'after 0s')
                    .replace(/id794038210725/g, 'id=794038210725')
                    .replace(/Terraformusedtheselected/g, '\n\nTerraform used the selected')
                    .replace(/providerstogenerate/g, 'providers to generate')
                    .replace(/thefollowingexecution/g, 'the following execution')
                    .replace(/plan\.Resource/g, 'plan. Resource')
                    .replace(/actionsareindicatedwith/g, 'actions are indicated with')
                    .replace(/thefollowingsymbols/g, 'the following symbols')
                    .replace(/create/g, '\n  + create')
                    .replace(/Terraformwillperform/g, '\n\nTerraform will perform')
                    .replace(/thefollowingactions/g, 'the following actions:')
                    .replace(/aws_([a-z_]+)\.([a-z_-]+)/g, '\n\n# aws_$1.$2')
                    .replace(/willbecreated/g, ' will be created')
                    .replace(/resource([a-z_]+)/g, '\n\nresource "$1"')
                    .replace(/([a-z_]+)\s+(known|false|true|us-east-1)/g, '\n    $1 = $2')
                    .replace(/knownafterapply/g, '(known after apply)')
                    .replace(/\s{2,}/g, ' ') // Normalize spaces
                    .split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0)
                    .join('\n');
            }

            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2><i class="fas fa-file-alt"></i> Plan Details - ${planData.repo_name}</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="plan-metadata" style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <p><strong>Repository:</strong> ${planData.repo_name}</p>
                                <p><strong>Timestamp:</strong> ${date}</p>
                                <p><strong>Changes:</strong> ${planData.changes_detected || 0}</p>
                                <p><strong>Status:</strong> <span style="color: ${planData.drift_detected ? '#dc3545' : '#28a745'}">${planData.drift_detected ? 'Drift Detected' : 'No Drift'}</span></p>
                                ${planData.ai_explanation?.evaluated_by ? `<p><strong>Evaluated by:</strong> ${planData.ai_explanation.evaluated_by}</p>` : ''}
                            </div>
                        </div>
                        <div class="plan-actions" style="margin-bottom: 20px;">
                            <button class="btn btn-primary" onclick="explainPlan('${planData.plan_id}')">
                                <i class="fas fa-robot"></i> AI Explain Plan
                            </button>
                            <button class="btn btn-warning" onclick="generatePostmortem('${planData.plan_id}')">
                                <i class="fas fa-clipboard-list"></i> Generate Postmortem
                            </button>
                        </div>
                        <div class="plan-content">
                            <h4>Terraform Plan Output:</h4>
                            <div style="
                                background: ${isError ? '#f8d7da' : '#f8f9fa'};
                                border: 1px solid ${isError ? '#f5c6cb' : '#dee2e6'};
                                border-radius: 8px;
                                max-height: 500px;
                                overflow-y: auto;
                                font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
                                font-size: 14px;
                                line-height: 1.6;
                            ">
                                ${isError ?
                                    `<div style="color: #721c24; padding: 16px; font-weight: bold;">⚠️ Scan Error</div>
                                     <div style="color: #721c24; padding: 0 16px 16px; white-space: pre-wrap;">${content}</div>` :
                                    content.split('\n').map(line => {
                                        if (line.includes('will be created')) return `<div style="color: #28a745; padding: 8px 16px; background: #d4edda; border-left: 3px solid #28a745;">➕ ${line}</div>`;
                                        if (line.includes('will be updated')) return `<div style="color: #ffc107; padding: 8px 16px; background: #fff3cd; border-left: 3px solid #ffc107;">♾ ${line}</div>`;
                                        if (line.includes('will be destroyed')) return `<div style="color: #dc3545; padding: 8px 16px; background: #f8d7da; border-left: 3px solid #dc3545;">❌ ${line}</div>`;
                                        if (line.startsWith('# aws_')) return `<div style="font-weight: bold; padding: 12px 16px; background: #e3f2fd; border-left: 4px solid #2196f3; color: #1976d2;">${line}</div>`;
                                        if (line.startsWith('resource ')) return `<div style="font-weight: bold; padding: 12px 16px; background: #e9ecef; border-left: 4px solid #007bff;">${line}</div>`;
                                        if (line.includes('Plan:')) return `<div style="font-weight: bold; padding: 12px 16px; background: #d1ecf1; color: #0c5460;">${line}</div>`;
                                        if (line.includes(' = ')) return `<div style="padding: 4px 32px; color: #6c757d; font-family: monospace;">${line}</div>`;
                                        if (line.startsWith('+ create')) return `<div style="color: #28a745; padding: 6px 16px; font-weight: bold;">${line}</div>`;
                                        return `<div style="padding: 4px 16px; color: #495057;">${line}</div>`;
                                    }).join('')
                                }
                            </div>
                        </div>
                    </div>
                </div>`;

            document.body.appendChild(modal);
        }

        // File selection handling
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('plan-file');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        document.querySelector('.file-drop-zone p').textContent = `Selected: ${file.name}`;
                        document.getElementById('upload-btn').disabled = false;
                    }
                });
            }
        });

        async function uploadPlan() {
            const fileInput = document.getElementById('plan-file');
            const file = fileInput.files[0];
            const resultElement = document.getElementById('upload-result');

            if (!file) {
                resultElement.innerHTML = '<div class="error">Please select a file first</div>';
                return;
            }

            resultElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing terraform plan...';
            document.getElementById('upload-btn').disabled = true;

            try {
                const planContent = await file.text();

                const token = localStorage.getItem('access_token');
                if (!token) {
                    resultElement.innerHTML = '<div class="error">Please login to upload plans</div>';
                    return;
                }

                const response = await fetch(`${CONFIG.API_BASE_URL}/upload-plan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        repo_name: currentRepo,
                        github_target: currentTarget,
                        plan_content: planContent
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    displayPlanResult(data);
                } else {
                    resultElement.innerHTML = `<div class="error">
                        <i class="fas fa-times-circle"></i> <strong>Error processing plan</strong>
                        <p>${data.error || 'Unknown error occurred'}</p>
                    </div>`;
                }
            } catch (error) {
                resultElement.innerHTML = `<div class="error">
                    <i class="fas fa-times-circle"></i> <strong>Upload failed</strong>
                    <p>Failed to process the terraform plan file.</p>
                </div>`;
            } finally {
                document.getElementById('upload-btn').disabled = false;
            }
        }

        function displayPlanResult(data) {
            const resultElement = document.getElementById('upload-result');

            if (data.drift_detected) {
                let html = `<div class="drift-detected">
                    <i class="fas fa-exclamation-triangle"></i> <strong>Drift Detected!</strong>
                    <p>Found ${data.total_changes} changes in your infrastructure</p>
                </div>`;

                if (data.changes.length > 0) {
                    html += '<div class="drift-details">';
                    data.changes.forEach(change => {
                        html += `<div class="drift-item">${change}</div>`;
                    });
                    if (data.total_changes > data.changes.length) {
                        html += `<div class="drift-item">... and ${data.total_changes - data.changes.length} more changes</div>`;
                    }
                    html += '</div>';
                }

                resultElement.innerHTML = html;
            } else {
                resultElement.innerHTML = `<div class="no-drift">
                    <i class="fas fa-check-circle"></i> <strong>No drift detected!</strong>
                    <p>Your infrastructure matches the terraform configuration.</p>
                </div>`;
            }
        }

        // Feature info modal functionality
        function showFeatureInfo() {
            document.getElementById('feature-modal').style.display = 'block';
        }

        function closeFeatureInfo() {
            document.getElementById('feature-modal').style.display = 'none';
        }

        function showDriftInfo() {
            document.getElementById('feature-modal').style.display = 'block';
        }

        // Cost info modal functionality
        function showCostInfo() {
            document.getElementById('cost-modal').style.display = 'block';
        }

        function closeCostInfo() {
            document.getElementById('cost-modal').style.display = 'none';
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const featureModal = document.getElementById('feature-modal');
            const uploadModal = document.getElementById('upload-modal');
            const costModal = document.getElementById('cost-modal');
            const budgetModal = document.getElementById('budget-modal');
            const budgetInfoModal = document.getElementById('budget-info-modal');
            const aiInfoModal = document.getElementById('ai-info-modal');
            const loginModal = document.getElementById('login-modal');
            const registerModal = document.getElementById('register-modal');

            if (event.target === featureModal) {
                featureModal.style.display = 'none';
            }
            if (event.target === uploadModal) {
                uploadModal.style.display = 'none';
            }
            if (event.target === costModal) {
                costModal.style.display = 'none';
            }
            if (event.target === budgetModal) {
                budgetModal.style.display = 'none';
            }
            if (event.target === budgetInfoModal) {
                budgetInfoModal.style.display = 'none';
            }
            if (event.target === aiInfoModal) {
                aiInfoModal.style.display = 'none';
            }
            if (event.target === loginModal) {
                loginModal.style.display = 'none';
            }
            if (event.target === registerModal) {
                registerModal.style.display = 'none';
            }



            const postmortemInfoModal = document.getElementById('postmortem-info-modal');
            if (event.target === postmortemInfoModal) {
                postmortemInfoModal.style.display = 'none';
            }
        }

        // Cost Dashboard Functions
        function initializeMonthSelector() {
            const selector = document.getElementById('month-selector');
            if (!selector || selector.options.length > 0) {
                return;
            }
            const currentDate = new Date();

            // Generate last 12 months
            for (let i = 0; i < 12; i++) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const value = date.toISOString().slice(0, 7); // YYYY-MM format
                const text = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });

                const option = document.createElement('option');
                option.value = value;
                option.textContent = text;
                if (i === 0) option.selected = true; // Current month selected

                selector.appendChild(option);
            }

            // Add event listener
            selector.addEventListener('change', function() {
                loadCostData();
            });
        }

        function getSelectedMonth() {
            const selector = document.getElementById('month-selector');
            return selector.value || null;
        }

        async function loadCostData() {
            const selectedMonth = getSelectedMonth();
            await Promise.all([
                loadCurrentCosts(selectedMonth),
                loadServiceCosts(selectedMonth),
                loadCostTrends(),
                loadTagCosts(selectedMonth),
                loadBudgetStatus()
            ]);
        }

        async function loadCurrentCosts(month = null) {
            const displayElement = document.getElementById('current-cost-display');
            const token = localStorage.getItem('access_token');

            if (!token) {
                displayElement.innerHTML = '<div class="cost-error"><i class="fas fa-lock"></i> Please login to view costs</div>';
                return;
            }

            try {
                const url = month ? `${CONFIG.API_BASE_URL}/costs/current?month=${month}` : `${CONFIG.API_BASE_URL}/costs/current`;
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    displayElement.innerHTML = `
                        <div class="current-cost">
                            <div class="cost-amount">$${parseFloat(data.total_cost).toFixed(2)}</div>
                            <div class="cost-period">${data.period}</div>
                            <div class="cost-updated">Last updated: ${new Date(data.last_updated).toLocaleString()}</div>
                        </div>`;
                } else {
                    displayElement.innerHTML = `<div class="cost-error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading costs: ${data.error}
                    </div>`;
                }
            } catch (error) {
                displayElement.innerHTML = `<div class="cost-error">
                    <i class="fas fa-times-circle"></i> Failed to load current costs
                </div>`;
            }
        }

        async function loadServiceCosts(month = null) {
            const displayElement = document.getElementById('service-costs-display');
            const token = localStorage.getItem('access_token');

            if (!token) {
                displayElement.innerHTML = '<div class="cost-error"><i class="fas fa-lock"></i> Please login to view service costs</div>';
                return;
            }

            try {
                const url = month ? `${CONFIG.API_BASE_URL}/costs/services?month=${month}` : `${CONFIG.API_BASE_URL}/costs/services`;
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    if (data.services.length === 0) {
                        displayElement.innerHTML = '<div class="no-costs">No service costs found for this period</div>';
                        return;
                    }

                    let html = '<div class="service-list">';
                    data.services.forEach(service => {
                        html += `
                            <div class="service-item">
                                <div class="service-name">${service.service}</div>
                                <div class="service-cost">$${parseFloat(service.cost).toFixed(2)}</div>
                            </div>`;
                    });
                    html += '</div>';

                    displayElement.innerHTML = html;
                } else {
                    displayElement.innerHTML = `<div class="cost-error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading service costs: ${data.error}
                    </div>`;
                }
            } catch (error) {
                displayElement.innerHTML = `<div class="cost-error">
                    <i class="fas fa-times-circle"></i> Failed to load service costs
                </div>`;
            }
        }

        async function loadCostTrends() {
            const displayElement = document.getElementById('cost-trends-display');
            const token = localStorage.getItem('access_token');

            if (!token) {
                displayElement.innerHTML = '<div class="cost-error"><i class="fas fa-lock"></i> Please login to view cost trends</div>';
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/costs/trends`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    if (data.daily_costs.length === 0) {
                        displayElement.innerHTML = '<div class="no-costs">No cost trend data available</div>';
                        return;
                    }

                    // Simple text-based chart for now
                    let html = '<div class="trends-list">';
                    const recentDays = data.daily_costs.slice(-7); // Last 7 days

                    recentDays.forEach(day => {
                        const date = new Date(day.date).toLocaleDateString();
                        html += `
                            <div class="trend-item">
                                <div class="trend-date">${date}</div>
                                <div class="trend-cost">$${parseFloat(day.cost).toFixed(2)}</div>
                            </div>`;
                    });

                    html += '</div>';
                    html += `<div class="trends-summary">Showing last 7 days of ${data.daily_costs.length} total days</div>`;

                    displayElement.innerHTML = html;
                } else {
                    displayElement.innerHTML = `<div class="cost-error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading cost trends: ${data.error}
                    </div>`;
                }
            } catch (error) {
                displayElement.innerHTML = `<div class="cost-error">
                    <i class="fas fa-times-circle"></i> Failed to load cost trends
                </div>`;
            }
        }

        async function loadTagCosts(month = null) {
            const displayElement = document.getElementById('tag-costs-display');
            const token = localStorage.getItem('access_token');

            if (!token) {
                displayElement.innerHTML = '<div class="cost-error"><i class="fas fa-lock"></i> Please login to view tagged costs</div>';
                return;
            }

            try {
                const url = month ? `${CONFIG.API_BASE_URL}/costs/by-tag?month=${month}` : `${CONFIG.API_BASE_URL}/costs/by-tag`;
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    if (data.services.length === 0) {
                        displayElement.innerHTML = '<div class="no-costs">No tagged resources found. Add "Service" tags to your AWS resources.</div>';
                        return;
                    }

                    let html = '<div class="service-list">';
                    data.services.forEach(service => {
                        html += `
                            <div class="service-item">
                                <div class="service-name">${service.service}</div>
                                <div class="service-cost">$${parseFloat(service.cost).toFixed(2)}</div>
                            </div>`;
                    });
                    html += '</div>';

                    displayElement.innerHTML = html;
                } else {
                    displayElement.innerHTML = `<div class="cost-error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading tagged costs: ${data.error}
                    </div>`;
                }
            } catch (error) {
                displayElement.innerHTML = `<div class="cost-error">
                    <i class="fas fa-times-circle"></i> Failed to load tagged costs
                </div>`;
            }
        }

        // Budget Management Functions
        function showBudgetModal() {
            document.getElementById('budget-modal').style.display = 'block';
        }

        function closeBudgetModal() {
            document.getElementById('budget-modal').style.display = 'none';
        }

        function showBudgetInfo() {
            document.getElementById('budget-info-modal').style.display = 'block';
        }

        function closeBudgetInfo() {
            document.getElementById('budget-info-modal').style.display = 'none';
        }

        // AI info modal functionality
        function showAIInfo() {
            document.getElementById('ai-info-modal').style.display = 'block';
        }

        function closeAIInfo() {
            document.getElementById('ai-info-modal').style.display = 'none';
        }

        // Postmortem info modal functionality
        function showPostmortemInfo() {
            document.getElementById('postmortem-info-modal').style.display = 'block';
        }

        function closePostmortemInfo() {
            document.getElementById('postmortem-info-modal').style.display = 'none';
        }



        async function saveBudgetConfig() {
            const budgetName = document.getElementById('budget-name').value.trim();
            const budgetAmount = document.getElementById('budget-amount').value;
            const budgetEmail = document.getElementById('budget-email').value.trim();
            const serviceFilter = document.getElementById('service-filter').value;

            // Get selected thresholds
            const thresholdCheckboxes = document.querySelectorAll('.threshold-options input[type="checkbox"]');
            const thresholds = [];
            thresholdCheckboxes.forEach((checkbox, index) => {
                if (checkbox.checked) {
                    thresholds.push([50, 80, 100][index]);
                }
            });

            if (!budgetName) {
                alert('Please enter a budget name');
                return;
            }

            if (!budgetAmount || budgetAmount <= 0) {
                alert('Please enter a valid budget amount');
                return;
            }

            if (thresholds.length === 0) {
                alert('Please select at least one alert threshold');
                return;
            }

            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to configure budgets');
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/budgets/configure`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        budget_name: budgetName,
                        monthly_limit: parseFloat(budgetAmount),
                        thresholds: thresholds,
                        email: budgetEmail,
                        service_filter: serviceFilter
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Budget alert configured successfully!');
                    closeBudgetModal();
                    loadBudgetStatus();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to configure budget alert');
            }
        }

        async function loadBudgetStatus() {
            const displayElement = document.getElementById('budget-status-display');
            const token = localStorage.getItem('access_token');

            if (!token) {
                displayElement.innerHTML = '<div class="budget-error"><i class="fas fa-lock"></i> Please login to view budget status</div>';
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/budgets/status`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    if (data.budgets.length === 0) {
                        displayElement.innerHTML = '<div class="no-budget">No budget alerts configured</div>';
                        return;
                    }

                    let html = '<div class="budget-list">';
                    data.budgets.forEach(budget => {
                        const statusClass = budget.status === 'over_budget' ? 'over-budget' :
                                          budget.status === 'warning' ? 'warning' : 'on-track';

                        html += `
                            <div class="budget-item ${statusClass}">
                                <div class="budget-info">
                                    <div class="budget-name">${budget.budget_name}</div>
                                    <div class="budget-usage">$${budget.current_spending} / $${budget.monthly_limit} (${budget.percentage_used}%)</div>
                                </div>
                                <div class="budget-actions">
                                    <div class="budget-status">${budget.status.replace('_', ' ')}</div>
                                    <button class="btn btn-sm btn-danger" onclick="deleteBudget('${budget.budget_id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>`;
                    });
                    html += '</div>';

                    displayElement.innerHTML = html;
                } else {
                    displayElement.innerHTML = `<div class="budget-error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading budget status: ${data.error}
                    </div>`;
                }
            } catch (error) {
                displayElement.innerHTML = `<div class="budget-error">
                    <i class="fas fa-times-circle"></i> Failed to load budget status
                </div>`;
            }
        }

        async function deleteBudget(budgetId) {
            if (!confirm('Are you sure you want to delete this budget alert?')) {
                return;
            }

            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to delete budgets');
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/budgets/delete/${budgetId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Budget deleted successfully!');
                    loadBudgetStatus();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to delete budget');
            }
        }

        // Drift Monitoring Functions
        function showDriftConfigModal() {
            document.getElementById('drift-config-modal').style.display = 'block';
        }

        function closeDriftConfigModal() {
            document.getElementById('drift-config-modal').style.display = 'none';
            resetDriftConfigModal();
        }

        function autoFillRepoName() {
            const githubUrl = document.getElementById('drift-github-url').value.trim();
            const repoNameField = document.getElementById('drift-repo-name');

            if (githubUrl && githubUrl.includes('github.com/')) {
                const match = githubUrl.match(/github\.com\/[^/]+\/([^/.]+)/);
                if (match && match[1]) {
                    repoNameField.value = match[1];
                    repoNameField.style.backgroundColor = '#e8f5e8';
                } else {
                    repoNameField.value = '';
                    repoNameField.style.backgroundColor = '';
                }
            } else {
                repoNameField.value = '';
                repoNameField.style.backgroundColor = '';
            }
        }

        async function saveDriftConfig() {
            const repoName = document.getElementById('drift-repo-name').value.trim();
            const githubUrl = document.getElementById('drift-github-url').value.trim();
            const terraformDir = document.getElementById('drift-terraform-dir').value.trim() || '.';
            const schedule = document.getElementById('drift-schedule').value;
            const alertEmail = document.getElementById('drift-alert-email').value.trim();

            if (!repoName || !githubUrl) {
                alert('Repository name and GitHub URL are required');
                return;
            }

            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to configure drift monitoring');
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/drift/configure`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        repo_name: repoName,
                        github_url: githubUrl,
                        terraform_dir: terraformDir,
                        schedule: schedule,
                        alert_email: alertEmail
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Drift monitoring configured successfully!');
                    closeDriftConfigModal();
                    loadDriftStatus();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to configure drift monitoring');
            }
        }

        async function loadDriftStatus() {
            const displayElement = document.getElementById('drift-status-display');
            const token = localStorage.getItem('access_token');

            if (!token) {
                displayElement.innerHTML = '<div class="drift-error"><i class="fas fa-lock"></i> Please login to view drift status</div>';
                return;
            }

            displayElement.innerHTML = '<div class="drift-loading"><i class="fas fa-spinner fa-spin"></i> Loading drift monitoring status...</div>';

            try {
                console.log('Fetching drift status from:', `${CONFIG.API_BASE_URL}/drift/status`);

                const response = await fetch(`${CONFIG.API_BASE_URL}/drift/status`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('Response status:', response.status);

                const data = await response.json();
                console.log('Response data:', data);

                if (response.ok) {
                    if (data.configurations.length === 0) {
                        displayElement.innerHTML = '<div class="no-drift-config">No repositories configured for drift monitoring</div>';
                        return;
                    }

                    let html = '<div class="drift-config-list">';
                    data.configurations.forEach(config => {
                        const lastScan = config.last_scan ? new Date(config.last_scan.timestamp).toLocaleString() : 'Never';
                        const driftStatus = config.last_scan?.drift_detected ? 'Drift Detected' : 'No Drift';
                        const statusClass = config.last_scan?.drift_detected ? 'has-drift' : 'no-drift';

                        html += `
                            <div class="drift-config-item ${statusClass}">
                                <div class="drift-config-info">
                                    <div class="drift-repo-name">${config.repo_name}</div>
                                    <div class="drift-schedule">Schedule: ${config.schedule}</div>
                                    <div class="drift-last-scan">Last scan: ${lastScan}</div>
                                    <div class="drift-alert-email">Alert email: ${config.alert_email || 'unset'}</div>
                                    <div class="drift-status">${driftStatus}</div>
                                </div>
                                <div class="drift-config-actions">
                                    <button class="btn btn-sm btn-primary" onclick="runManualScan('${config.config_id}')" title="Run manual scan">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="viewLastScan('${config.repo_name}')" title="View last scan">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="editDriftConfig('${config.config_id}', '${config.repo_name}', '${config.schedule}', '${config.alert_email || ''}')" title="Edit configuration">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteDriftConfig('${config.config_id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>`;
                    });
                    html += '</div>';

                    displayElement.innerHTML = html;
                } else {
                    console.error('API error:', data);
                    displayElement.innerHTML = `<div class="drift-error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading drift status: ${data.error || 'Unknown error'}
                    </div>`;
                }
            } catch (error) {
                console.error('Network error:', error);
                displayElement.innerHTML = `<div class="drift-error">
                    <i class="fas fa-times-circle"></i> Failed to load drift status: ${error.message}
                </div>`;
            }
        }

        async function runManualScan(configId) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to run manual scans');
                return;
            }

            // Find the button and show loading state
            const button = document.querySelector(`button[onclick="runManualScan('${configId}')"]`);
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            button.disabled = true;

            try {
                // Properly encode the config_id for URL
                const encodedConfigId = encodeURIComponent(configId);
                const response = await fetch(`${CONFIG.API_BASE_URL}/drift/scan/${encodedConfigId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Manual scan completed! Check the results.');
                    setTimeout(loadDriftStatus, 1000);
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to start manual scan');
            } finally {
                // Restore button state
                button.innerHTML = originalHTML;
                button.disabled = false;
            }
        }

        async function viewLastScan(repoName) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to view scan results');
                return;
            }

            try {
                console.log('Fetching plan history for:', repoName);
                const response = await fetch(`${CONFIG.API_BASE_URL}/plan-history/${repoName}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();
                console.log('Plan history response:', data);

                if (response.ok && data.plans.length > 0) {
                    const latestPlan = data.plans[0];
                    console.log('Latest plan:', latestPlan);
                    // Ensure repo_name is set for the modal
                    latestPlan.repo_name = repoName;

                    // Get full plan details
                    const detailsResponse = await fetch(`${CONFIG.API_BASE_URL}/plan-details/${encodeURIComponent(latestPlan.plan_id)}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const detailsData = await detailsResponse.json();
                    console.log('Plan details response:', detailsData);
                    console.log('Plan content:', detailsData.plan_content);

                    if (detailsResponse.ok) {
                        showPlanDetailsModal(detailsData);
                    } else {
                        showPlanDetailsModal(latestPlan);
                    }
                } else {
                    console.log('No plans found or error:', data);
                    alert('No scan results found for this repository');
                }
            } catch (error) {
                console.error('Error loading scan results:', error);
                alert('Failed to load scan results');
            }
        }

        function editDriftConfig(configId, repoName, currentSchedule, currentEmail) {
            // Pre-populate the modal with current values
            document.getElementById('drift-repo-name').value = repoName;
            document.getElementById('drift-repo-name').readOnly = true;
            document.getElementById('drift-github-url').style.display = 'none';
            document.getElementById('drift-github-url').previousElementSibling.style.display = 'none';
            document.getElementById('drift-terraform-dir').style.display = 'none';
            document.getElementById('drift-terraform-dir').previousElementSibling.style.display = 'none';
            document.getElementById('drift-schedule').value = currentSchedule;
            document.getElementById('drift-alert-email').value = currentEmail;

            // Change the save button to update
            const saveBtn = document.querySelector('#drift-config-modal .btn-primary');
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Update Configuration';
            saveBtn.onclick = () => updateDriftConfig(configId);

            showDriftConfigModal();
        }

        async function updateDriftConfig(configId) {
            const schedule = document.getElementById('drift-schedule').value;
            const alertEmail = document.getElementById('drift-alert-email').value.trim();

            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to update drift monitoring');
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/drift/update/${encodeURIComponent(configId)}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        schedule: schedule,
                        alert_email: alertEmail
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Configuration updated successfully!');
                    closeDriftConfigModal();
                    resetDriftConfigModal();
                    loadDriftStatus();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to update configuration');
            }
        }

        function resetDriftConfigModal() {
            // Reset modal to original state
            document.getElementById('drift-repo-name').readOnly = false;
            document.getElementById('drift-repo-name').value = '';
            document.getElementById('drift-github-url').style.display = 'block';
            document.getElementById('drift-github-url').previousElementSibling.style.display = 'block';
            document.getElementById('drift-github-url').value = '';
            document.getElementById('drift-terraform-dir').style.display = 'block';
            document.getElementById('drift-terraform-dir').previousElementSibling.style.display = 'block';
            document.getElementById('drift-terraform-dir').value = '.';
            document.getElementById('drift-schedule').value = 'daily';
            document.getElementById('drift-alert-email').value = '';

            // Reset save button
            const saveBtn = document.querySelector('#drift-config-modal .btn-primary');
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Configuration';
            saveBtn.onclick = saveDriftConfig;
        }

        async function deleteDriftConfig(configId) {
            if (!confirm('Are you sure you want to stop monitoring this repository?')) {
                return;
            }

            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to delete configurations');
                return;
            }

            try {
                // Properly encode the config_id for URL
                const encodedConfigId = encodeURIComponent(configId);
                const response = await fetch(`${CONFIG.API_BASE_URL}/drift/delete/${encodedConfigId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Configuration deleted successfully!');
                    loadDriftStatus();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to delete configuration');
            }
        }

        // Auto-setup drift monitoring from config
        async function autoSetupDriftMonitoring() {
            const token = localStorage.getItem('access_token');
            if (!token || !CONFIG.GITHUB_TARGETS || CONFIG.GITHUB_TARGETS.length === 0) {
                return;
            }

            console.log('Auto-discovering terraform repos for drift monitoring...');

            for (const githubTarget of CONFIG.GITHUB_TARGETS) {
                try {
                    // Scan GitHub target for terraform repos
                    const scanResponse = await fetch(`${CONFIG.API_BASE_URL}/scan-repos`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            github_target: githubTarget,
                            github_token: CONFIG.GITHUB_TOKEN || null
                        })
                    });

                    if (!scanResponse.ok) continue;

                    const scanData = await scanResponse.json();

                    // Get existing drift configurations
                    const existingResponse = await fetch(`${CONFIG.API_BASE_URL}/drift/status`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    const existingConfigs = existingResponse.ok ?
                        (await existingResponse.json()).configurations : [];

                    // Auto-configure each terraform repo found
                    for (const repo of scanData.results || []) {
                        const alreadyExists = existingConfigs.some(config =>
                            config.repo_name === repo.repo_name
                        );

                        if (alreadyExists) {
                            console.log(`Repo ${repo.repo_name} already configured`);
                            continue;
                        }

                        // Auto-configure this terraform repo
                        const configResponse = await fetch(`${CONFIG.API_BASE_URL}/drift/configure`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                repo_name: repo.repo_name,
                                github_url: repo.repo_url.replace('https://github.com/', 'https://github.com/') + '.git',
                                terraform_dir: '.',
                                schedule: 'daily',
                                alert_email: CONFIG.AUTO_MONITOR_DEFAULTS?.alert_email || ''
                            })
                        });

                        if (configResponse.ok) {
                            console.log(`Auto-configured drift monitoring for ${repo.repo_name}`);
                        }
                    }
                } catch (error) {
                    console.log(`Failed to auto-discover repos for ${githubTarget}:`, error);
                }
            }

            // Refresh drift status after auto-setup
            setTimeout(loadDriftStatus, 1000);
        }

        // Add repository to drift monitoring
        async function addToMonitoring(repoName, repoUrl, githubTarget) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to add repositories to monitoring');
                return;
            }

            // Check if already exists
            try {
                const statusResponse = await fetch(`${CONFIG.API_BASE_URL}/drift/status`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (statusResponse.ok) {
                    const statusData = await statusResponse.json();
                    const alreadyExists = statusData.configurations.some(config =>
                        config.repo_name === repoName
                    );

                    if (alreadyExists) {
                        alert(`${repoName} is already being monitored`);
                        return;
                    }
                }

                // Add to monitoring
                const response = await fetch(`${CONFIG.API_BASE_URL}/drift/configure`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        repo_name: repoName,
                        github_url: repoUrl.endsWith('.git') ? repoUrl : repoUrl + '.git',
                        terraform_dir: '.',
                        schedule: 'daily',
                        alert_email: ''
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert(`${repoName} added to drift monitoring!`);
                    loadDriftStatus();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to add repository to monitoring');
            }
        }

        // Auto-populate GitHub targets
        function populateGitHubTargets() {
            const githubInput = document.getElementById('github-target');
            if (CONFIG.GITHUB_TARGETS && CONFIG.GITHUB_TARGETS.length > 0) {
                githubInput.placeholder = `e.g., ${CONFIG.GITHUB_TARGETS[0]}`;

                // Add dropdown for quick selection
                const datalist = document.createElement('datalist');
                datalist.id = 'github-targets';
                CONFIG.GITHUB_TARGETS.forEach(target => {
                    const option = document.createElement('option');
                    option.value = target;
                    datalist.appendChild(option);
                });
                githubInput.setAttribute('list', 'github-targets');
                githubInput.parentNode.appendChild(datalist);
            }
        }

        // Authentication Functions
        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'block';
        }

        function closeLoginModal() {
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('login-result').innerHTML = '';
        }

        function showRegisterModal() {
            document.getElementById('register-modal').style.display = 'block';
        }

        function closeRegisterModal() {
            document.getElementById('register-modal').style.display = 'none';
            document.getElementById('register-result').innerHTML = '';
        }

        async function login() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const resultElement = document.getElementById('login-result');

            if (!email || !password) {
                resultElement.innerHTML = '<div class="error">Please enter email and password</div>';
                return;
            }

            resultElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // Store tokens
                    localStorage.setItem('access_token', data.access_token);
                    localStorage.setItem('id_token', data.id_token);
                    localStorage.setItem('refresh_token', data.refresh_token);
                    localStorage.setItem('user_email', email);

                    // Update UI
                    updateAuthUI(true, email);
                    closeLoginModal();

                    // Refresh data after login
                    refreshDataAfterLogin();

                    resultElement.innerHTML = '<div class="success">Login successful!</div>';
                } else {
                    resultElement.innerHTML = `<div class="error">${data.error}</div>`;
                }
            } catch (error) {
                resultElement.innerHTML = '<div class="error">Login failed. Please try again.</div>';
            }
        }

        async function register() {
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const resultElement = document.getElementById('register-result');

            if (!email || !password) {
                resultElement.innerHTML = '<div class="error">Please enter email and password</div>';
                return;
            }

            if (password.length < 8) {
                resultElement.innerHTML = '<div class="error">Password must be at least 8 characters</div>';
                return;
            }

            resultElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    resultElement.innerHTML = '<div class="success">Account created! You can now login.</div>';
                    setTimeout(() => {
                        closeRegisterModal();
                        showLoginModal();
                    }, 2000);
                } else {
                    resultElement.innerHTML = `<div class="error">${data.error}</div>`;
                }
            } catch (error) {
                resultElement.innerHTML = '<div class="error">Registration failed. Please try again.</div>';
            }
        }

        function logout() {
            // Clear tokens
            localStorage.removeItem('access_token');
            localStorage.removeItem('id_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('user_email');

            // Update UI
            updateAuthUI(false);

            // Refresh data after logout to show login messages
            refreshDataAfterLogout();
        }

        function refreshDataAfterLogout() {
            // Show login messages on all tabs
            loadDriftStatus();

            // Clear cost displays
            const costDisplays = [
                'current-cost-display',
                'service-costs-display',
                'cost-trends-display',
                'tag-costs-display',
                'budget-status-display'
            ];

            costDisplays.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.innerHTML = '<div class="cost-error"><i class="fas fa-lock"></i> Please login to view data</div>';
                }
            });
        }

        function updateAuthUI(isLoggedIn, email = '') {
            const authSection = document.getElementById('auth-section');
            const userSection = document.getElementById('user-section');
            const userEmailSpan = document.getElementById('user-email');

            if (isLoggedIn) {
                authSection.style.display = 'none';
                userSection.style.display = 'block';
                userEmailSpan.textContent = email;
            } else {
                authSection.style.display = 'block';
                userSection.style.display = 'none';
            }
        }

        function checkAuthStatus() {
            const token = localStorage.getItem('access_token');
            const email = localStorage.getItem('user_email');

            if (token && email) {
                updateAuthUI(true, email);
            }
        }

        function refreshDataAfterLogin() {
            // Refresh drift status if on drift tab
            if (document.querySelector('.tab-btn[data-tab="drift"]').classList.contains('active')) {
                loadDriftStatus();
            }

            // Refresh cost data if on costs tab
            if (document.querySelector('.tab-btn[data-tab="costs"]').classList.contains('active')) {
                loadCostData();
            }
        }

        // AI Explanation Functions
        async function loadAIExplanations() {
            const displayElement = document.getElementById('ai-explanations-display');
            const token = localStorage.getItem('access_token');

            if (!token) {
                displayElement.innerHTML = '<div class="ai-error"><i class="fas fa-lock"></i> Please login to view AI explanations</div>';
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/ai/explanations`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.explanations.length === 0) {
                        displayElement.innerHTML = '<div class="no-explanations">No AI explanations yet. Upload terraform plans and click "AI Explain Plan" to get started.</div>';
                        return;
                    }

                    let html = '<div class="explanations-list">';
                    data.explanations.forEach(explanation => {
                        const date = new Date(explanation.ai_analyzed_at).toLocaleString();
                        const riskColor = {
                            'LOW': '#28a745',
                            'MEDIUM': '#ffc107',
                            'HIGH': '#dc3545',
                            'UNKNOWN': '#6c757d'
                        }[explanation.ai_explanation.risk_level] || '#6c757d';

                        html += `
                            <div class="explanation-item">
                                <div class="explanation-header">
                                    <div class="explanation-repo">${explanation.repo_name}</div>
                                    <div class="explanation-date">${date}</div>
                                    <div class="explanation-model" style="font-size: 12px; color: #6c757d;">
                                        ${explanation.ai_explanation.evaluated_by || 'Unknown'}
                                    </div>
                                    <div class="explanation-risk" style="color: ${riskColor}">
                                        Risk: ${explanation.ai_explanation.risk_level}
                                    </div>
                                </div>
                                <div class="explanation-summary">
                                    ${explanation.ai_explanation.summary}
                                </div>
                            </div>`;
                    });
                    html += '</div>';

                    displayElement.innerHTML = html;
                } else {
                    displayElement.innerHTML = `<div class="ai-error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading explanations: ${data.error}
                    </div>`;
                }
            } catch (error) {
                displayElement.innerHTML = `<div class="ai-error">
                    <i class="fas fa-times-circle"></i> Failed to load AI explanations
                </div>`;
            }
        }

        async function explainPlan(planId) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to use AI explanations');
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/ai/explain`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        plan_id: planId
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('AI explanation generated! Check the AI Assistant tab.');
                    loadAIExplanations();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to generate AI explanation');
            }
        }

        // Postmortem Functions
        function showCreatePostmortemModal() {
            // Open the conversational postmortem creator in a new window
            window.open('conversational-postmortem.html', 'postmortem', 'width=900,height=900,scrollbars=yes,resizable=yes');
        }







        async function loadPostmortems() {
            const displayElement = document.getElementById('postmortems-display');
            const token = localStorage.getItem('access_token');

            if (!token) {
                displayElement.innerHTML = '<div class="postmortem-error"><i class="fas fa-lock"></i> Please login to view postmortems</div>';
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/postmortems`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.postmortems.length === 0) {
                        displayElement.innerHTML = '<div class="no-postmortems">No postmortems yet. Create a postmortem to get started.</div>';
                        return;
                    }

                    let html = '<div class="postmortems-list">';
                    data.postmortems.forEach(postmortem => {
                        const date = new Date(postmortem.created_at).toLocaleString();
                        const severityColor = {
                            'low': '#28a745',
                            'medium': '#ffc107',
                            'high': '#dc3545'
                        }[postmortem.severity] || '#6c757d';

                        html += `
                            <div class="postmortem-item" style="margin-bottom: 15px; padding: 15px; border: 1px solid #dee2e6; border-radius: 8px; cursor: pointer; background: #fff;" onclick="viewPostmortem('${postmortem.postmortem_id}')">
                                <div class="postmortem-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div class="postmortem-title" style="font-weight: bold; font-size: 16px;">${postmortem.title}</div>
                                    <div>
                                        <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); editPostmortem('${postmortem.postmortem_id}')" title="Edit postmortem">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deletePostmortem('${postmortem.postmortem_id}')" title="Delete postmortem">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; font-size: 14px; color: #6c757d;">
                                    <div><strong>Service:</strong> ${postmortem.service}</div>
                                    <div><strong>Status:</strong> ${postmortem.status}</div>
                                    <div><strong>Severity:</strong> <span style="color: ${severityColor}">${(postmortem.severity || 'unknown').toUpperCase()}</span></div>
                                </div>
                                <div style="margin-top: 8px; font-size: 12px; color: #6c757d;">
                                    Created: ${date}
                                </div>
                            </div>`;
                    });
                    html += '</div>';

                    displayElement.innerHTML = html;
                } else {
                    displayElement.innerHTML = `<div class="postmortem-error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading postmortems: ${data.error}
                    </div>`;
                }
            } catch (error) {
                displayElement.innerHTML = `<div class="postmortem-error">
                    <i class="fas fa-times-circle"></i> Failed to load postmortems
                </div>`;
            }
        }

        async function generatePostmortem(planId) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to generate postmortems');
                return;
            }

            // Get plan details first
            try {
                const planResponse = await fetch(`${CONFIG.API_BASE_URL}/plan-details/${encodeURIComponent(planId)}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const planData = await planResponse.json();

                if (!planResponse.ok) {
                    alert('Failed to get plan details');
                    return;
                }

                // Create postmortem with plan data
                const now = new Date();
                const response = await fetch(`${CONFIG.API_BASE_URL}/postmortems`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        title: `Terraform Plan Failure - ${planData.repo_name}`,
                        service: planData.repo_name,
                        severity: 'medium',
                        start_time: planData.timestamp,
                        incident_summary: 'Terraform plan execution failed',
                        include_terraform: true,
                        include_costs: false
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Postmortem created! Check the AI Assistant tab.');
                    loadPostmortems();
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to generate postmortem');
            }
        }

        async function editPostmortem(postmortemId) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to edit postmortems');
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/postmortems/${postmortemId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (response.ok) {
                    showEditPostmortemModal(data);
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to load postmortem for editing');
            }
        }

        function showEditPostmortemModal(postmortemData) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.id = 'edit-postmortem-modal';

            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2><i class="fas fa-edit"></i> Edit Postmortem</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="edit-title">Title</label>
                            <input type="text" id="edit-title" value="${postmortemData.title}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group">
                            <label for="edit-service">Service</label>
                            <input type="text" id="edit-service" value="${postmortemData.service}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group">
                            <label for="edit-severity">Severity</label>
                            <select id="edit-severity" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="low" ${postmortemData.severity === 'low' ? 'selected' : ''}>Low</option>
                                <option value="medium" ${postmortemData.severity === 'medium' ? 'selected' : ''}>Medium</option>
                                <option value="high" ${postmortemData.severity === 'high' ? 'selected' : ''}>High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-status">Status</label>
                            <select id="edit-status" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="draft" ${postmortemData.status === 'draft' ? 'selected' : ''}>Draft</option>
                                <option value="in_progress" ${postmortemData.status === 'in_progress' ? 'selected' : ''}>In Progress</option>
                                <option value="complete" ${postmortemData.status === 'complete' ? 'selected' : ''}>Complete</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-summary">Executive Summary</label>
                            <textarea id="edit-summary" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">${postmortemData.executive_summary || postmortemData.incident_summary || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="edit-root-cause">Root Cause</label>
                            <textarea id="edit-root-cause" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">${postmortemData.root_cause_analysis || postmortemData.root_cause || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="edit-impact">Impact Assessment</label>
                            <textarea id="edit-impact" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">${postmortemData.impact_assessment || postmortemData.impact || ''}</textarea>
                        </div>
                    </div>
                    <div class="modal-footer" style="padding: 20px; border-top: 1px solid #dee2e6; text-align: right;">
                        <button class="btn btn-primary" onclick="savePostmortemChanges('${postmortemData.postmortem_id}')">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            Cancel
                        </button>
                    </div>
                </div>`;

            document.body.appendChild(modal);
        }

        async function savePostmortemChanges(postmortemId) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to save changes');
                return;
            }

            const updatedData = {
                title: document.getElementById('edit-title').value,
                service: document.getElementById('edit-service').value,
                severity: document.getElementById('edit-severity').value,
                status: document.getElementById('edit-status').value,
                executive_summary: document.getElementById('edit-summary').value,
                root_cause_analysis: document.getElementById('edit-root-cause').value,
                impact_assessment: document.getElementById('edit-impact').value
            };

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/postmortems/${postmortemId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(updatedData)
                });

                if (response.ok) {
                    alert('Postmortem updated successfully!');
                    document.getElementById('edit-postmortem-modal').remove();
                    loadPostmortems();
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to save changes');
            }
        }

        async function deletePostmortem(postmortemId) {
            if (!confirm('Are you sure you want to delete this postmortem?')) {
                return;
            }

            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to delete postmortems');
                return;
            }

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/postmortems/${postmortemId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    alert('Postmortem deleted successfully!');
                    loadPostmortems();
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Failed to delete postmortem');
            }
        }

        async function viewPostmortem(postmortemId) {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login to view postmortem details');
                return;
            }

            try {
                console.log('Fetching postmortem:', postmortemId);
                const response = await fetch(`${CONFIG.API_BASE_URL}/postmortems/${postmortemId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);

                if (response.ok) {
                    try {
                        showPostmortemModal(data);
                    } catch (modalError) {
                        console.error('Modal error:', modalError);
                        alert(`Modal error: ${modalError.message}`);
                    }
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                console.error('Error loading postmortem:', error);
                alert('Failed to load postmortem details');
            }
        }

        function openServiceDocs() {
            // Check if user is logged in
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login first to access service documentation');
                return;
            }

            // Open in new tab with auth token
            const url = `service-docs.html?token=${encodeURIComponent(token)}`;
            const newWindow = window.open(url, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
            if (!newWindow) {
                // Fallback if popup blocked
                window.location.href = url;
            }
        }

        function showServiceDocsInfoModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-search"></i> About Service Documentation Search</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="info-section">
                            <h3><i class="fas fa-magic"></i> How It Works</h3>
                            <p>Upload your service documentation and ask questions in natural language. AI provides step-by-step answers perfect for incident response.</p>

                            <div class="process-steps">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <strong>Upload Documentation</strong>
                                        <p>Drag & drop runbooks, troubleshooting guides, API docs</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <strong>Ask Questions</strong>
                                        <p>"Payment API is down, what should I check?"</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <strong>Get AI Answers</strong>
                                        <p>Step-by-step instructions from your documentation</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <h3><i class="fas fa-cogs"></i> Features</h3>
                            <div class="capabilities">
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Natural language queries</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>AI-powered responses with source citations</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Service-organized documentation</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Perfect for 3AM incident response</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <h3><i class="fas fa-dollar-sign"></i> Cost-Effective Design</h3>
                            <div class="benefits">
                                <div class="benefit">
                                    <i class="fas fa-database"></i>
                                    <div>
                                        <strong>S3 Storage</strong>
                                        <p>~$0.50/month for document storage with lifecycle management</p>
                                    </div>
                                </div>
                                <div class="benefit">
                                    <i class="fas fa-table"></i>
                                    <div>
                                        <strong>DynamoDB</strong>
                                        <p>~$0.25/month for metadata and search indexing</p>
                                    </div>
                                </div>
                                <div class="benefit">
                                    <i class="fas fa-robot"></i>
                                    <div>
                                        <strong>AI Processing</strong>
                                        <p>~$1-2/month pay-per-query with Amazon Nova Lite</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <h3><i class="fas fa-lightbulb"></i> Why This Approach Works</h3>
                            <div class="benefits">
                                <div class="benefit">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <div>
                                        <strong>Fast</strong>
                                        <p>AI responses in seconds using optimized document retrieval</p>
                                    </div>
                                </div>
                                <div class="benefit">
                                    <i class="fas fa-bullseye"></i>
                                    <div>
                                        <strong>Accurate</strong>
                                        <p>Responses include source citations from your actual documentation</p>
                                    </div>
                                </div>
                                <div class="benefit">
                                    <i class="fas fa-dollar-sign"></i>
                                    <div>
                                        <strong>Cost-Effective</strong>
                                        <p>Pay-per-query model with Amazon Nova Lite keeps costs minimal</p>
                                    </div>
                                </div>
                                <div class="benefit">
                                    <i class="fas fa-shield-alt"></i>
                                    <div>
                                        <strong>Reliable</strong>
                                        <p>Built on AWS serverless architecture with automatic scaling</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <h3><i class="fas fa-rocket"></i> Future Enhancements</h3>
                            <div class="future-features">
                                <div class="future-item">
                                    <div class="future-day">Day 12</div>
                                    <div class="future-desc">Slack bot integration for documentation queries</div>
                                </div>
                                <div class="future-item">
                                    <div class="future-day">Day 13</div>
                                    <div class="future-desc">AI-powered PR reviews with documentation context</div>
                                </div>
                                <div class="future-item">
                                    <div class="future-day">Future</div>
                                    <div class="future-desc">Auto-sync with GitHub wikis and README files</div>
                                </div>
                                <div class="future-item">
                                    <div class="future-day">Future</div>
                                    <div class="future-desc">Version control and change tracking for documents</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;

            document.body.appendChild(modal);
        }

        function openResourceDiscovery() {
            // Check if user is logged in
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('Please login first to access resource discovery');
                return;
            }

            // Open in new tab
            const url = 'resource-discovery.html';
            const newWindow = window.open(url, '_blank', 'width=1400,height=900,scrollbars=yes,resizable=yes');
            if (!newWindow) {
                // Fallback if popup blocked
                window.location.href = url;
            }
        }

        // Slack Bot Functions
        function showSlackSetupModal() {
            // Populate API endpoints
            const baseUrl = CONFIG.API_BASE_URL;
            document.getElementById('slack-events-url').value = `${baseUrl}/slack/events`;
            document.getElementById('slack-commands-url').value = `${baseUrl}/slack/commands`;

            document.getElementById('slack-setup-modal').style.display = 'block';
        }

        function closeSlackSetupModal() {
            document.getElementById('slack-setup-modal').style.display = 'none';
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999);
            document.execCommand('copy');

            // Show feedback
            const button = element.nextElementSibling;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i>';
            button.style.color = '#28a745';

            setTimeout(() => {
                button.innerHTML = originalText;
                button.style.color = '';
            }, 2000);
        }

        function loadSlackStatus() {
            const displayElement = document.getElementById('slack-status-display');

            displayElement.innerHTML = `
                <div class="slack-capabilities">
                    <div class="capability-section">
                        <h4><i class="fas fa-terminal"></i> Slash Commands</h4>
                        <div class="capabilities">
                            <div class="capability">
                                <i class="fas fa-check-circle"></i>
                                <span><code>/cloudops status</code> - Infrastructure overview</span>
                            </div>
                            <div class="capability">
                                <i class="fas fa-check-circle"></i>
                                <span><code>/cloudops drift</code> - Check repository drift</span>
                            </div>
                            <div class="capability">
                                <i class="fas fa-check-circle"></i>
                                <span><code>/cloudops costs</code> - AWS cost analysis</span>
                            </div>
                        </div>
                    </div>

                    <div class="capability-section">
                        <h4><i class="fas fa-robot"></i> AI Assistant</h4>
                        <div class="capabilities">
                            <div class="capability">
                                <i class="fas fa-check-circle"></i>
                                <span>Natural language queries with <code>@CloudOps</code></span>
                            </div>
                            <div class="capability">
                                <i class="fas fa-check-circle"></i>
                                <span>Service documentation search and Q&A</span>
                            </div>
                        </div>
                    </div>

                    <div class="slack-cost-info">
                        <h4><i class="fas fa-dollar-sign"></i> Cost: ~$3.50/month</h4>
                        <p>Pay-per-request serverless architecture</p>
                    </div>
                </div>
            `;
        }

        function showSlackInfo() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fab fa-slack"></i> About CloudOps Slack Bot</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="info-section">
                            <h3><i class="fas fa-magic"></i> How It Works</h3>
                            <p>Bring CloudOps directly into your Slack workspace with AI-powered infrastructure monitoring.</p>
                        </div>

                        <div class="info-section">
                            <h3><i class="fas fa-terminal"></i> Commands</h3>
                            <div class="capabilities">
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span><code>/cloudops status</code> - Infrastructure overview</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span><code>@CloudOps [question]</code> - AI-powered Q&A</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;

            document.body.appendChild(modal);
        }

        function showResourceDiscoveryInfo() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-search-plus"></i> About Smart Resource Discovery</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="info-section">
                            <h3><i class="fas fa-magic"></i> How It Works</h3>
                            <p>Automatically discover all AWS resources in your account and use AI to group them into logical services with cost attribution.</p>

                            <div class="process-steps">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <strong>Scan AWS Account</strong>
                                        <p>Discover all resources across EC2, Lambda, RDS, S3, and more</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <strong>AI Analysis</strong>
                                        <p>Amazon Nova Lite analyzes tags, names, and relationships</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <strong>Service Grouping</strong>
                                        <p>Get intelligent service suggestions with confidence scores</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <h3><i class="fas fa-cogs"></i> Features</h3>
                            <div class="capabilities">
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Automatic discovery of all AWS resource types</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>AI-powered service grouping with confidence scores</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Real-time cost attribution per service</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Manual and scheduled daily scanning</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Interactive approval workflow</span>
                                </div>
                                <div class="capability">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Multi-region support</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <h3><i class="fas fa-dollar-sign"></i> Cost Analysis</h3>
                            <p>Extremely cost-effective: ~$0.25/month total</p>
                            <ul>
                                <li>AWS API calls: FREE (Describe/List APIs)</li>
                                <li>Lambda execution: ~$0.20/month</li>
                                <li>AI processing: ~$0.001/month (Nova Lite)</li>
                                <li>DynamoDB storage: ~$0.0001/month</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h3><i class="fas fa-lightbulb"></i> Example Results</h3>
                            <div class="benefits">
                                <div class="benefit">
                                    <i class="fas fa-users"></i>
                                    <div>
                                        <strong>User Service (95% confidence)</strong>
                                        <p>user-api-lambda, user-db-rds, user-cache-redis - $245/month</p>
                                    </div>
                                </div>
                                <div class="benefit">
                                    <i class="fas fa-credit-card"></i>
                                    <div>
                                        <strong>Payment Service (88% confidence)</strong>
                                        <p>payment-lambda, payment-queue-sqs, payment-secrets - $89/month</p>
                                    </div>
                                </div>
                                <div class="benefit">
                                    <i class="fas fa-chart-bar"></i>
                                    <div>
                                        <strong>Analytics Service (92% confidence)</strong>
                                        <p>analytics-kinesis, analytics-s3, analytics-glue - $156/month</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;

            document.body.appendChild(modal);
        }

        function showPostmortemModal(postmortemData) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';

            const date = new Date(postmortemData.created_at).toLocaleString();
            const startTime = new Date(postmortemData.start_time).toLocaleString();
            const endTime = postmortemData.end_time ? new Date(postmortemData.end_time).toLocaleString() : 'Ongoing';

            modal.innerHTML = `
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <h2><i class="fas fa-clipboard-list"></i> ${postmortemData.title}</h2>
                        <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="postmortem-metadata" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div><strong>Service:</strong> ${postmortemData.service}</div>
                                <div><strong>Status:</strong> ${postmortemData.status}</div>
                                <div><strong>Severity:</strong> <span style="color: ${postmortemData.severity === 'high' ? '#dc3545' : postmortemData.severity === 'medium' ? '#ffc107' : '#28a745'}">${(postmortemData.severity || 'unknown').toUpperCase()}</span></div>
                                <div><strong>Owner:</strong> ${postmortemData.owner_id || 'Unassigned'}</div>
                                <div><strong>Start Time:</strong> ${startTime}</div>
                                <div><strong>End Time:</strong> ${endTime}</div>
                            </div>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-clipboard"></i> Executive Summary</h3>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; line-height: 1.6;">
                                ${postmortemData.executive_summary || postmortemData.incident_summary || 'Executive summary pending'}
                            </div>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-search"></i> Root Cause Analysis</h3>
                            <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border-left: 4px solid #ffc107;">
                                ${postmortemData.root_cause_analysis || postmortemData.root_cause || 'Root cause analysis pending'}
                            </div>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-exclamation-triangle"></i> Impact Assessment</h3>
                            <div style="background: #f8d7da; padding: 15px; border-radius: 6px; border-left: 4px solid #dc3545;">
                                ${postmortemData.impact_assessment || postmortemData.impact || 'Impact assessment pending'}
                            </div>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-eye"></i> Detection & Response</h3>
                            <p>${postmortemData.detection_and_response || postmortemData.detection_narrative || 'Detection and response analysis pending'}</p>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-wrench"></i> Resolution Details</h3>
                            <p>${postmortemData.resolution_details || postmortemData.resolution_narrative || 'Resolution details pending'}</p>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-clock"></i> Detailed Timeline</h3>
                            <div class="timeline">
                                ${Array.isArray(postmortemData.detailed_timeline) ? postmortemData.detailed_timeline.map(event => `
                                    <div class="timeline-item" style="border-left: 3px solid #007bff; padding-left: 15px; margin-bottom: 15px;">
                                        <div class="timeline-time" style="font-weight: bold; color: #007bff;">${event.timestamp ? new Date(event.timestamp).toLocaleString() : event.time || 'Time TBD'}</div>
                                        <div class="timeline-event" style="font-weight: 500;">${event.event || event.description || 'Event details'}</div>
                                        <div class="timeline-details" style="color: #6c757d;">${event.details || event.technical_details || ''}</div>
                                    </div>
                                `).join('') : '<p>Detailed timeline to be constructed</p>'}
                            </div>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-lightbulb"></i> Lessons Learned</h3>
                            <ul>
                                ${(postmortemData.lessons_learned || []).map(lesson => `<li>${lesson}</li>`).join('') || '<li>Lessons learned analysis pending</li>'}
                            </ul>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-tasks"></i> Action Items</h3>
                            <ul>
                                ${(postmortemData.action_items || []).map(item => `<li>${item}</li>`).join('') || '<li>Action items to be defined</li>'}
                            </ul>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-shield-alt"></i> Preventive Measures</h3>
                            <ul>
                                ${(postmortemData.preventive_measures || []).map(measure => `<li>${measure}</li>`).join('') || '<li>Preventive measures to be identified</li>'}
                            </ul>
                        </div>

                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-chart-line"></i> Monitoring Improvements</h3>
                            <ul>
                                ${(postmortemData.monitoring_improvements || []).map(improvement => `<li>${improvement}</li>`).join('') || '<li>Monitoring improvements to be defined</li>'}
                            </ul>
                        </div>

                        ${postmortemData.include_terraform ? `
                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-code"></i> Terraform Data</h3>
                            <p>Found ${(postmortemData.terraform_data || []).length} terraform plans in the incident timeframe</p>
                        </div>` : ''}

                        ${postmortemData.include_costs ? `
                        <div class="postmortem-section" style="margin-bottom: 20px;">
                            <h3><i class="fas fa-dollar-sign"></i> Cost Impact</h3>
                            <p>Total cost during incident: $${parseFloat(postmortemData.cost_data?.total_cost || 0).toFixed(2)}</p>
                        </div>` : ''}
                    </div>
                </div>`;

            document.body.appendChild(modal);
        }

    </script>
</body>
</html>
